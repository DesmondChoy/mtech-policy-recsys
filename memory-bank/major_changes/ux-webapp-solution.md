# Major Change: Customer-Focused UX Web App for Policy Recommendation System

## Background & Diagnosis

### Pain Points Identified
- **Limited User Interaction:** Existing system lacks an intuitive, user-friendly interface for customers to engage with recommendation reports.
- **Fragmented Experience:** Customers currently receive reports in a static format (PDF/email), making it hard to compare, trace, or interact with recommendations.
- **Mobile Accessibility:** No optimized solution for users on mobile devices.
- **Transparency:** Customers have limited visibility into the reasoning behind recommendations or access to raw supporting documents.

### Diagnosis
- The absence of a centralized, interactive, and mobile-friendly interface reduces engagement, trust, and usability for end customers.
- Customers need a way to:
  - Easily log in and access their personalized reports
  - Interactively compare policy recommendations
  - Review the rationale (transcripts) and supporting documents (PDFs)
  - Take further actions (feedback, contact advisor, etc.)

## Solution: Responsive Web App (MVP)

### Key Features
- **Landing Page with Login Simulation:**
  - Customer logs in by selecting their ID from a drop-down menu (MVP simplification).
  - After login, user is presented with their personalized dashboard.
- **Chrome-Style Tabbed Report Interface:**
  - Immediately present the user's most recent (or only) recommendation report in a main content area
  - Provide a browser-like tab bar at the top (inspired by Chrome), with tabs for:
    - Recommendation (streaming content)
    - Policy Comparison
    - Chat Transcript
    - Raw PDFs
- **Feedback & Next Steps:**
  - Simple feedback widget (thumbs up/down, comments).
  - Contact advisor button for further queries.
- **Mobile-First Design:**
  - Responsive layouts, touch-friendly navigation, and PWA features for mobile usability.

### Tech Stack Recommendation
- **Frontend:** React (with Material UI or Chakra UI), React Router
- **Backend (if needed):** FastAPI (Python) or Express.js (Node.js), but not required for MVP if data exists
- **Other:** PWA support for mobile, local launch via terminal command, no deployment needed

---

## Summary
This major change introduces a customer-focused, mobile-friendly web app to address the pain points of limited interactivity, fragmented experience, and lack of transparency. The solution leverages a simple login simulation, a Chrome-style tabbed report interface, and an interactive report viewer, all built on a modern, responsive tech stack. This will significantly improve customer engagement, trust, and usability for the policy recommendation system.

---

### Integration with Existing System

- The web app will directly interface with the project’s structured outputs (customer requirements, policy data, comparison reports) generated by the current Python pipelines.
- No mock data is required; customer selection will surface real, dynamically loaded data.
- This ensures the UI is always in sync with the latest backend intelligence and evaluations.

### Customer Journey (User Stories)

- **User Story 1:**  
  As a customer, I select my ID, view my personalized dashboard, and access detailed policy comparison reports, including the reasoning and original documents.
- **User Story 2:**  
  As a customer, I can open the original transcript and policy PDF to verify or share with an advisor.

### MVP Scope and Future Enhancements

- **MVP:** Focuses on report viewing, comparison, and transparency.
- **Future:** Plans for direct feedback, iterative refinement, and conversational UI.

### Accessibility & Internationalization

- The UI will be designed with accessibility in mind (keyboard navigation, screen reader support).
- Multi-language support will be considered for broader reach.

---

**Suggestions Incorporated:**
- Linked UI to project architecture and data flow
- Highlighted transparency, trust, and real data integration
- Added user stories for clarity
- Clarified MVP scope and future vision
- Noted accessibility and internationalization

---

### Implementation Plan: Step-by-Step Checklist

#### 1. Project Setup
- [x] Create a new feature branch for the UX web app (e.g., `ux-webapp`)
- [x] Set up the React project with Vite or Create React App
- [x] Install dependencies (Material UI/Chakra UI, React Router, etc.)
- [x] Configure project structure (components, pages, assets, utils)

#### 2. Data Integration Preparation
- [x] Implement utility functions to load real data from the backend/scripts/output folders
- [x] Define interfaces/types for structured data (TypeScript)
- [x] Update customer ID drop-down to use real customer IDs from results folder (each folder name is a customer UUID)
- [x] Utility: Add function to extract customer IDs from results folder (and optionally from data/transcripts/raw/synthetic JSON filenames)
- [x] Identify and document the data sources (customer IDs, requirements, policies, reports) in the codebase for maintainability

#### 3. Landing & Login Simulation
- [x] Design landing page layout (mobile-first)
- [x] Implement initial customer ID drop-down login component (placeholder data)
- [x] Refactor layout so the customer ID dropdown is right-aligned and visually subtle (for demo/MVP only).
- [x] Ensure the dropdown is removed (or hidden) in production builds.
- [x] Make the central input field accept either dropdown selection or manual entry.
- [x] Implement validation: only allow valid customer IDs in the input.
- [x] Display a visible but non-jarring error message ("User not found") if an invalid ID is entered.
- [x] Hide the dropdown after the Continue button is clicked.
- [x] Remove any previous logic or UI that assumed the dropdown was always visible or on the left.
- [x] Document the MVP/demo vs. production distinction in the code and documentation.
- [x] Add a "Random" button to the right dropdown menu that selects a random customer ID from the list and updates both the dropdown and the central input field. The button should be subtle, compact, and demo-friendly (e.g., use a shuffle icon with a tooltip, placed below the dropdown).

#### 4. Transcript Confirmation Flow (Post-Landing)
- [x] After entering a valid customer ID and clicking Continue, show only the customer's transcript (from `data/transcripts/processed/parsed_transcript_{scenario}_{uuid}.json`).
- [x] Render the transcript as chat bubbles with speaker labels (messaging app style).
- [x] Display a visually distinct confirmation prompt ("Is this your transcript?") at the top of the page, with clear Yes/No buttons.
- [x] On Yes: Navigate to an animation/transition page (placeholder for now).
- [x] On No: Return to the landing page.
- [x] Only after the animation, proceed to the Chrome-style tabbed report interface. The transcript tab here also references the processed transcript.
- [x] Ensure transcript confirmation state does not persist across reloads. Chrome-style interface is only accessible after confirmation/animation.
- [x] **Implementation:** Added `useScrollReveal` hook and `ChatBubble` component, and updated `TranscriptPage.tsx` to animate chat bubbles on scroll.

#### 5. Chrome-Style Tabbed Report Interface (Post-Confirmation)
- [ ] After transcript confirmation and animation, present the user's main report interface as previously designed (with tabs for Recommendation, Policy Comparison, Customer Requirements, Transcript, Policy PDFs, etc.).

#### 6. Tab Content Details
- [ ] **Recommendation Tab:** Render Markdown as rich text from the appropriate file
- [ ] **Policy Comparison Tab:** Dropdown menu for insurer selection; render selected Markdown file as rich text
- [ ] **Customer Requirements Tab:** Render JSON as pretty-printed, rich text
- [ ] **Transcript Tab:** Render JSON as pretty-printed, rich text or chat timeline
- [ ] **Policy PDFs Tab:** Display all four insurer PDFs (one per insurer) using an embedded PDF viewer or download link; deduplicate if multiple files per insurer

#### 7. Feedback & Contact
- [ ] Add feedback widget (thumbs up/down, comments)
- [ ] Implement contact advisor button/modal

#### 8. Mobile & Accessibility
- [ ] Test and refine mobile responsiveness (all screens)
- [ ] Add accessibility features (keyboard navigation, ARIA labels, screen reader support)

#### 9. Quality & Testing
- [ ] Write unit and integration tests for key components
- [ ] Conduct end-to-end walkthroughs (customer journey)
- [ ] Fix bugs and polish UI/UX

#### 10. Documentation & Handover
- [ ] Document setup, usage, and key design decisions in README
- [ ] Update Memory Bank with implementation notes and lessons learned

#### 11. Automate Transcript Index Generation
- [x] Automate transcript index generation: Updated the sync-public-assets.cjs Node.js script to scan all processed transcript files, extract customer UUIDs, and write an up-to-date transcripts_index.json to the public folder. This ensures the frontend always finds the correct transcript file for any customer ID, with no manual editing required.

#### 12. Keep Customer IDs in Sync with Processed Transcripts
- [x] Automated the generation of `customer_ids.json` in the sync-public-assets.cjs script. This file is now always built from the UUIDs of available processed transcripts, ensuring the landing page dropdown only shows valid, available customers. No manual editing required; always in sync with transcript data.

---

**Update: Customer ID Sync Workflow Simplified (2025-04-18)**

- The Python script `extract_customer_ids.py` has been **deleted**. It is no longer needed for generating `customer_ids.json`.
- The Node.js script `ux-webapp/scripts/sync-public-assets.cjs` is now the **sole source of truth** for generating both `transcripts_index.json` and `customer_ids.json` in the public directory.
- The `predev` script in `package.json` has been updated to only run the Node.js sync script, ensuring customer IDs always match the current set of processed transcript files.
- This change guarantees there are no stale or extra IDs in `customer_ids.json`.

**Impact:**
- Running `npm run dev` now always results in an accurate, up-to-date `customer_ids.json` reflecting only the files in `data/transcripts/processed`.
- The workflow is simpler and less error-prone.

---

**Data Mapping Summary:**
- **Customer ID (UUID):** Used for all file lookups per customer
- **Recommendation:** `results/{uuid}/recommendation_report_{uuid}.md`
- **Policy Comparison:** `results/{uuid}/policy_comparison_report_{insurer}.md` (dropdown for insurer)
- **Customer Requirements:** `data/extracted_customer_requirements/requirements_{scenario}_{uuid}.json`
- **Transcript:** `data/transcripts/raw/synthetic/transcript_{scenario}_{uuid}.json`
- **Policy PDFs:** All four PDFs from `data/policies/raw/` (one per insurer, shown for any customer)

**Rendering:**
- Markdown and JSON files are rendered as rich text (Markdown viewer, pretty JSON)
- PDFs are displayed using an embedded PDF viewer

---

### UX Enhancements: Loading Screen & Background (Complete)

**Objective:** Improve the user experience during processing and provide a modern, consistent visual style across the app.

**Key Changes Implemented:**

1.  **Transition Page (`TransitionPage.tsx`):**
    *   Implemented a sequenced loading screen displaying witty, context-aware messages in phases.
    *   Added a Material UI palette shimmer animation to the loading messages (`primary.main`, `secondary.main`, `primary.light`).
    *   Included pulsing dots (`...`) to indicate ongoing processing.
    *   Increased message display duration to 2000ms (2 seconds) per phase for better readability.

2.  **Global Background Styling (`index.css`):**
    *   Initially set a global blue-gray background (`#e7ebf0`) in `App.css`.
    *   Troubleshooting revealed conflicts with `index.css` default styles.
    *   Implemented a layered blue-white gradient background (radial and linear) inspired by the Landing Page for a modern, premium feel.
    *   Resolved scrolling distortion issues (visible lines/banding) by applying the gradient to a fixed `body::before` pseudo-element. This ensures a seamless, static background effect across all pages and scroll positions.
    *   Removed conflicting background styles from `index.css` and empty rulesets.

**Status:** Complete. The app now features an engaging loading sequence and a consistent, modern, static gradient background.

---

### Customer ID Selection & Input – Updated Solution & To-Do Plan

### Overview

- The customer ID dropdown will be positioned on the right side of the screen, styled subtly for MVP/demo purposes only.
- In production, this dropdown will be removed entirely.
- The central input field allows users to either select a customer ID from the dropdown or type it manually.
- Only valid customer IDs are accepted. If the input does not match a valid ID, a visible but non-jarring error message ("User not found") will appear.
- After clicking the Continue button, the dropdown disappears.

---

### To-Do Tasks

- [x] Refactor layout so the customer ID dropdown is right-aligned and visually subtle (for demo/MVP only).
- [x] Ensure the dropdown is removed (or hidden) in production builds.
- [x] Make the central input field accept either dropdown selection or manual entry.
- [x] Implement validation: only allow valid customer IDs in the input.
- [x] Display a visible but non-jarring error message ("User not found") if an invalid ID is entered.
- [x] Hide the dropdown after the Continue button is clicked.
- [x] Remove any previous logic or UI that assumed the dropdown was always visible or on the left.
- [x] Document the MVP/demo vs. production distinction in the code and documentation.

---

### Notes

- The dropdown is present only for demonstration purposes in the MVP. In production, customer ID selection will rely solely on the central input field.
- The error message should be styled as a helper text or a subtle alert below the input field, not as a modal or toast.
